import{_ as I}from"./plugin-vue_export-helper.f9bdc015.js";import{h as g,i as p,r as V,c as f,d as o,n as _,w as a,j as b,e as w,v as u,k as v,m as C,a as x,o as h,t as c,q as k,l as y,s as S,u as F,x as L,f as D,F as P}from"./vendor.62028223.js";const $={name:"ChatHistory",data:()=>({client_id:"icyqwwpy744ugu5x4ymyt6jqrnpxso",code:"",username:"",vod_filter:"",start_filter:"",end_filter:"",user_filter:"",message_filter:"",vods:[],filteredVods:[],comments:[],filteredComments:[],loadedComments:[],loadedCommentIndex:0,cancelCommentFetch:!1,commentFetchInProgress:!1}),methods:{formatDate(e){if(e)return g(String(e)).format("YYYY-MM-DD")},formatTime(e){if(e)return g(String(e)).format("hh:mm:ss A")},filterVods(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.filteredVods=this.vods.filter(this.compareVod)},200)},compareVod(e){return!(!e.title.toLowerCase().includes(this.vod_filter.toLowerCase())&&this.vod_filter!==""||g(e.created_at).isBefore(this.start_filter)&&this.start_filter!==""||g(e.created_at).isAfter(this.end_filter)&&this.end_filter!=="")},filterComments(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.loadedCommentIndex=0,this.loadedComments=[],this.filteredComments=this.comments.filter(this.compareComment),this.loadedComments=this.loadedComments.concat(this.filteredComments.slice(this.loadedCommentIndex,this.loadedCommentIndex+1001)),this.loadedCommentIndex=this.loadedComments.length},200)},onCommentScroll({target:{scrollTop:e,clientHeight:t,scrollHeight:n}}){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{if(e+t>=n){var l=this.loadedComments.length;this.loadedComments=this.loadedComments.concat(this.filteredComments.slice(this.loadedCommentIndex,this.loadedCommentIndex+1001)),this.loadedCommentIndex+=this.loadedComments.length-l}},200)},compareComment(e){return!(!e.username.toLowerCase().includes(this.user_filter.toLowerCase())&&this.user_filter!==""||!e.message.toLowerCase().includes(this.message_filter.toLowerCase())&&this.message_filter!=="")},async getUserId(){const e={"Client-ID":this.client_id,Authorization:"Bearer "+this.code};return(await p.get(`https://api.twitch.tv/helix/users?login=${this.username}`,{headers:e})).data.data[0].id},async getVods(){var e=await this.getUserId(),t="";this.vods=[],this.filteredVods=[];do{const l={"Client-ID":this.client_id,Authorization:"Bearer "+this.code},d=await p.get(`https://api.twitch.tv/helix/videos?user_id=${e}&first=100&after=${t}`,{headers:l});var n=d.data.data.map(r=>({id:r.id,created_at:r.created_at,title:r.title}));if(this.vods.push(...n),this.filteredVods.push(...n.filter(this.compareVod)),d.data.pagination.cursor)t=d.data.pagination.cursor;else break}while(t)},async getComments(e){if(this.commentFetchInProgress)for(this.cancelCommentFetch=!0;this.commentFetchInProgress;)await new Promise(s=>setTimeout(s,1e3));const t={"Client-ID":this.client_id},n=`https://api.twitch.tv/v5/videos/${e.target.value}/comments`;var l="";this.comments=[],this.filteredComments=[],this.loadedComments=[],this.loadedCommentIndex=0,this.commentFetchInProgress=!0;do{var d=l===null||l===""?`${n}?content_offset_seconds=0`:`${n}?cursor=${l}`;const s=await p.get(d,{headers:t});var r=s.data.comments.map(i=>({created_at:i.created_at,username:i.commenter.display_name,message:i.message.body,user_color:i.message.user_color,vod_link:`https://www.twitch.tv/videos/${e.target.value}?t=${Math.floor(i.content_offset_seconds/3600)}h${Math.floor(i.content_offset_seconds/60)}m${Math.floor(i.content_offset_seconds%60)}s`}));this.comments.push(...r);var m=r.filter(this.compareComment);if(this.filteredComments.push(...m),this.loadedComments.length<1e3&&this.loadedComments.push(...m),s.data._next)l=s.data._next;else break;if(this.comments.length>1e4)break}while(l&&!this.cancelCommentFetch);this.loadedCommentIndex=this.loadedComments.length,this.commentFetchInProgress=!1,this.cancelCommentFetch=!1}},created:function(){const e=new URLSearchParams(window.location.search),t=new URLSearchParams(window.location.hash.substr(1));e.get("code")?this.code=urlParams.get("code"):t.get("access_token")&&(this.code=t.get("access_token"))}},T={class:"flex flex-wrap h-full w-full text-white p-2"},U={class:"h-1/3 w-full xl:w-1/3 xl:h-full border-b-4 border-gray-600 pb-2 xl:pb-0 xl:pr-2 xl:border-b-0 xl:border-r-4"},A={class:"flex flex-col h-full w-full gap-2"},z={class:"flex flex-wrap gap-2 min-w-full"},B={class:"flex gap-2 min-w-full max-h-full pb-2 border-b-5 border-gray-600"},M=["href"],E={class:"text-xs md:text-base xl:text-lg"},j={class:"text-xs md:text-base xl:text-lg"},O=x("ALLOWED "),Y=["disabled"],q={class:"text-xs md:text-base xl:text-lg"},H=x("VODS "),N={class:"flex gap-2 min-w-full"},R=["value"],W={class:"h-2/3 w-full xl:w-2/3 xl:h-full pt-2 xl:pt-0 xl:pl-2"},G={class:"flex flex-col rounded-md h-full border-3 border-gray-600 bg-gray-900"},J={class:"flex w-full border-b-4 border-gray-600"},K={class:"w-full bg-gray-900 text-left"},Q={class:"w-full"},X={class:"flex even:bg-gray-800"},Z={class:"px-3 py-1 w-full self-center"},ee=["href"],te=["href"];function se(e,t,n,l,d,r){const m=V("font-awesome-icon");return h(),f("div",T,[o("div",U,[o("div",A,[o("div",z,[o("div",B,[o("a",{href:`https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=${e.client_id}&redirect_uri=https://encrypted-thoughts.github.io/chat-history&scope=chat:read&force_verify=true`,class:_([e.code?"":"animate-pulse","w-1/4 text-center bg-gray-900 border-2 border-gray-600 hover:bg-gray-700 font-bold py-2 px-1 shadow-lg rounded-md"])},[a(o("span",E,"ALLOW ACCESS",512),[[b,!e.code]]),a(o("span",j,[O,w(m,{icon:"check",class:"text-green-600"})],512),[[b,e.code]])],10,M),a(o("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>e.username=s),type:"text",class:"form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900 px-3 py-2 rounded-md w-2/4",placeholder:"Enter a username..."},null,512),[[u,e.username]]),o("button",{onClick:t[1]||(t[1]=s=>r.getVods()),disabled:!e.username||!e.code,class:"bg-gray-900 border-2 border-gray-600 hover:bg-gray-700 font-bold py-2 px-1 shadow-lg rounded-md w-1/4 disabled:opacity-50"},[o("span",q,[H,w(m,{icon:"search"})])],8,Y)]),o("div",N,[a(o("input",{onInput:t[2]||(t[2]=s=>r.filterVods()),id:"vod-filter","onUpdate:modelValue":t[3]||(t[3]=s=>e.vod_filter=s),type:"text",class:"w-1/3 focus:outline-none focus:ring-0 focus:border-green-700 form-input bg-gray-900 px-3 py-2 rounded-md disabled:opacity-50",placeholder:"Filter on VOD name..."},null,544),[[u,e.vod_filter]]),a(o("input",{onInput:t[4]||(t[4]=s=>r.filterVods()),id:"start_time","onUpdate:modelValue":t[5]||(t[5]=s=>e.start_filter=s),type:"datetime-local",class:_([e.start_filter?"":"start-time","w-1/3 flex-1 form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900 px-3 py-2 rounded-md disabled:opacity-50"]),placeholder:"Start time filter..."},null,34),[[u,e.start_filter]]),a(o("input",{onInput:t[6]||(t[6]=s=>r.filterVods()),id:"end_time","onUpdate:modelValue":t[7]||(t[7]=s=>e.end_filter=s),type:"datetime-local",class:_([e.end_filter?"":"end-time","w-1/3 flex-1 form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900 px-3 py-2 rounded-md disabled:opacity-50"]),placeholder:"End time filter..."},null,34),[[u,e.end_filter]])])]),o("select",{onChange:t[8]||(t[8]=s=>r.getComments(s)),size:"20",class:"focus:outline-none focus:ring-0 focus:border-green-800 p-0 h-full w-full border-2 border-gray-600 bg-gray-900 rounded-md bg-none scrollbar-thin scrollbar-thumb-green-900 hover:scrollbar-thumb-green-800 scrollbar-track-gray-500"},[(h(!0),f(v,null,C(e.filteredVods,(s,i)=>(h(),f("option",{value:s.id,class:"rounded-sm even:bg-gray-800 w-full p-1 pl-3"},c(r.formatDate(s.created_at))+": "+c(s.title),9,R))),256))],32)])]),o("div",W,[o("div",G,[o("div",J,[a(o("input",{onInput:t[9]||(t[9]=s=>r.filterComments()),id:"user_filter","onUpdate:modelValue":t[10]||(t[10]=s=>e.user_filter=s),type:"text",class:"w-1/2 form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900",placeholder:"Filter on username..."},null,544),[[u,e.user_filter]]),a(o("input",{onInput:t[11]||(t[11]=s=>r.filterComments()),id:"message_filter","onUpdate:modelValue":t[12]||(t[12]=s=>e.message_filter=s),type:"text",class:"w-1/2 form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900",placeholder:"Filter on message..."},null,544),[[u,e.message_filter]])]),o("div",{onScroll:t[13]||(t[13]=(...s)=>r.onCommentScroll&&r.onCommentScroll(...s)),class:"h-full scrollbar-thin scrollbar-thumb-green-900 scrollbar-track-gray-500 scrollbar scrollbar-thumb-green-900 hover:scrollbar-thumb-green-800 scrollbar-track-gray-500"},[o("div",K,[o("div",Q,[(h(!0),f(v,null,C(e.loadedComments,s=>(h(),f("div",X,[o("div",Z,[o("a",{class:"text-gray-400 pr-1",href:s.vod_link,target:"_blank",rel:"noopener noreferrer"},c(r.formatTime(s.created_at)),9,ee),o("a",{style:k({color:s.user_color}),href:`https://www.twitch.tv/${s.username}`,target:"_blank",rel:"noopener noreferrer"},c(s.username),13,te),o("span",null,": "+c(s.message),1)])]))),256))])])],32)])]),a(w(m,{icon:"spinner",pulse:"",class:"absolute bottom-5 right-7"},null,512),[[b,e.commentFetchInProgress]])])}var oe=I($,[["render",se],["__scopeId","data-v-bc8d7c6c"]]);y.add(S);y.add(F);y.add(L);D(oe).component("font-awesome-icon",P).mount("#app");
