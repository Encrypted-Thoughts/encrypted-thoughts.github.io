import{_ as w}from"./plugin-vue_export-helper.f9bdc015.js";import{h as p,i as g,c as h,d as r,w as a,v as d,j as b,k as _,p as y,b as v,o as u,t as c,l as C,m as x,f as I,F as V}from"./vendor.2a20604a.js";const S={name:"ChatHistory",data:()=>({client_id:"icyqwwpy744ugu5x4ymyt6jqrnpxso",code:"",username:"",vod_filter:"",start_filter:"",end_filter:"",user_filter:"",message_filter:"",vods:[],filteredVods:[],comments:[],filteredComments:[],loadedComments:[],loadedCommentIndex:0,cancelCommentFetch:!1,commentFetchInProgress:!1}),methods:{formatDate(t){if(t)return p(String(t)).format("YYYY/MM/DD hh:mm:ss A")},filterVods(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.filteredVods=this.vods.filter(this.compareVod)},200)},compareVod(t){return!(!t.title.toLowerCase().includes(this.vod_filter.toLowerCase())&&this.vod_filter!==""||p(t.created_at).isBefore(this.start_filter)&&this.start_filter!==""||p(t.created_at).isAfter(this.end_filter)&&this.end_filter!=="")},filterComments(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.loadedCommentIndex=0,this.loadedComments=[],this.filteredComments=this.comments.filter(this.compareComment),this.loadedComments=this.loadedComments.concat(this.filteredComments.slice(this.loadedCommentIndex,this.loadedCommentIndex+1001)),this.loadedCommentIndex=this.loadedComments.length},200)},onCommentScroll({target:{scrollTop:t,clientHeight:e,scrollHeight:i}}){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{if(t+e>=i){var l=this.loadedComments.length;this.loadedComments=this.loadedComments.concat(this.filteredComments.slice(this.loadedCommentIndex,this.loadedCommentIndex+1001)),this.loadedCommentIndex+=this.loadedComments.length-l}},200)},compareComment(t){return!(!t.username.toLowerCase().includes(this.user_filter.toLowerCase())&&this.user_filter!==""||!t.message.toLowerCase().includes(this.message_filter.toLowerCase())&&this.message_filter!=="")},async getUserId(){const t={"Client-ID":this.client_id,Authorization:"Bearer "+this.code};return(await g.get(`https://api.twitch.tv/helix/users?login=${this.username}`,{headers:t})).data.data[0].id},async getVods(){var t=await this.getUserId(),e="";this.vods=[],this.filteredVods=[];do{const l={"Client-ID":this.client_id,Authorization:"Bearer "+this.code},n=await g.get(`https://api.twitch.tv/helix/videos?user_id=${t}&first=100&after=${e}`,{headers:l});var i=n.data.data.map(o=>({id:o.id,created_at:o.created_at,title:o.title}));if(this.vods.push(...i),this.filteredVods.push(...i.filter(this.compareVod)),n.data.pagination.cursor)e=n.data.pagination.cursor;else break}while(e)},async getComments(t){if(this.commentFetchInProgress)for(this.cancelCommentFetch=!0;this.commentFetchInProgress;)await new Promise(m=>setTimeout(m,1e3));const e={"Client-ID":this.client_id},i=`https://api.twitch.tv/v5/videos/${t.target.value}/comments`;var l="";this.comments=[],this.filteredComments=[],this.loadedComments=[],this.loadedCommentIndex=0,this.commentFetchInProgress=!0;do{var n=l===null||l===""?`${i}?content_offset_seconds=0`:`${i}?cursor=${l}`;const m=await g.get(n,{headers:e});var o=m.data.comments.map(f=>({created_at:f.created_at,username:f.commenter.display_name,message:f.message.body}));this.comments.push(...o);var s=o.filter(this.compareComment);if(this.filteredComments.push(...s),this.loadedComments.length<1e3&&this.loadedComments.push(...s),m.data._next)l=m.data._next;else break}while(l&&!this.cancelCommentFetch);this.loadedCommentIndex=this.loadedComments.length,this.commentFetchInProgress=!1,this.cancelCommentFetch=!1}},created:function(){const t=new URLSearchParams(window.location.search),e=new URLSearchParams(window.location.hash.substr(1));t.get("code")?this.code=urlParams.get("code"):e.get("access_token")&&(this.code=e.get("access_token"))}},k=t=>(y("data-v-b535c16a"),t=t(),v(),t),T={class:"flex flex-wrap h-full w-full text-white p-2"},U={class:"h-1/3 w-full xl:w-1/3 xl:h-full border-b-4 border-gray-600 pb-2 xl:pb-0 xl:pr-2 xl:border-b-0 xl:border-r-4"},D={class:"flex flex-col h-full w-full gap-2"},F={class:"flex flex-wrap gap-2 min-w-full"},P={class:"flex gap-2 min-w-full max-h-full"},A=["href"],E={class:"flex gap-2 min-w-full"},L=["disabled"],M={class:"flex gap-2 min-w-full"},$=["value"],B={class:"h-2/3 w-full xl:w-2/3 xl:h-full pt-2 xl:pt-0 xl:pl-2"},j={class:"flex flex-col rounded-md h-full border-3 border-gray-600 bg-gray-900"},z={class:"flex w-full border-b-4 border-gray-600"},O=k(()=>r("div",{class:"self-center py-2 px-3 min-w-52 w-1/6"},"TIMESTAMP",-1)),Y={class:"py-2 px-2 border-l-3 border-gray-600 min-w-28 w-1/6"},H={class:"py-2 px-2 border-l-3 border-gray-600 w-4/6"},N={class:"w-full bg-gray-900 text-left"},R={class:"w-full"},q={class:"flex even:bg-gray-800"},G={class:"px-3 py-1 min-w-52 w-1/6 self-center"},K={class:"px-3 py-1 min-w-28 w-1/6 self-center"},J={class:"px-3 py-1 w-4/6"};function Q(t,e,i,l,n,o){return u(),h("div",T,[r("div",U,[r("div",D,[r("div",F,[r("div",P,[r("a",{href:`https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=${t.client_id}&redirect_uri=https://encrypted-thoughts.github.io/chat-history&scope=chat:read&force_verify=true`,class:"text-center bg-gray-900 border-2 border-gray-600 w-1/3 hover:bg-gray-700 font-bold py-2 px-3 shadow-lg rounded-md"}," GET TOKEN ",8,A),a(r("input",{id:"code","onUpdate:modelValue":e[0]||(e[0]=s=>t.code=s),type:"text",class:"form-input bg-gray-900 px-3 py-2 rounded-md w-2/3",placeholder:"Enter Access Token"},null,512),[[d,t.code]])]),r("div",E,[a(r("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.username=s),type:"text",class:"form-input bg-gray-900 px-3 py-2 rounded-md w-2/3",placeholder:"Enter Username"},null,512),[[d,t.username]]),r("button",{onClick:e[2]||(e[2]=s=>o.getVods()),disabled:!this.username||!this.code,class:"bg-gray-900 border-2 border-gray-600 hover:bg-gray-700 font-bold py-2 px-3 shadow-lg rounded-md w-1/3 disabled:opacity-50 disabled:hover"}," LOAD VOD LIST ",8,L)]),a(r("input",{onInput:e[3]||(e[3]=s=>o.filterVods()),id:"vod-filter","onUpdate:modelValue":e[4]||(e[4]=s=>t.vod_filter=s),type:"text",class:"form-input bg-gray-900 px-3 py-2 rounded-md min-w-full disabled:opacity-50",placeholder:"Filter on VOD name..."},null,544),[[d,t.vod_filter]]),r("div",M,[a(r("input",{onInput:e[5]||(e[5]=s=>o.filterVods()),id:"start_time","onUpdate:modelValue":e[6]||(e[6]=s=>t.start_filter=s),type:"datetime-local",class:"flex-1 form-input bg-gray-900 px-3 py-2 rounded-md disabled:opacity-50",placeholder:"Start time filter..."},null,544),[[d,t.start_filter]]),a(r("input",{onInput:e[7]||(e[7]=s=>o.filterVods()),id:"end_time","onUpdate:modelValue":e[8]||(e[8]=s=>t.end_filter=s),type:"datetime-local",class:"flex-1 form-input bg-gray-900 px-3 py-2 rounded-md disabled:opacity-50",placeholder:"End time filter..."},null,544),[[d,t.end_filter]])])]),r("select",{onChange:e[9]||(e[9]=s=>o.getComments(s)),size:"20",class:"p-0 h-full w-full border-2 border-gray-600 bg-gray-900 rounded-md bg-none scrollbar-thin scrollbar-thumb-green-900 hover:scrollbar-thumb-green-800 scrollbar-track-gray-500"},[(u(!0),h(b,null,_(t.filteredVods,(s,m)=>(u(),h("option",{value:s.id,class:"rounded-sm even:bg-gray-800 w-full p-1 pl-3"},c(o.formatDate(s.created_at))+": "+c(s.title),9,$))),256))],32)])]),r("div",B,[r("div",j,[r("div",z,[O,r("div",Y,[a(r("input",{onInput:e[10]||(e[10]=s=>o.filterComments()),id:"user_filter","onUpdate:modelValue":e[11]||(e[11]=s=>t.user_filter=s),type:"text",class:"form-input bg-gray-900 rounded-md w-full placeholder-white",placeholder:"USERNAME"},null,544),[[d,t.user_filter]])]),r("div",H,[a(r("input",{onInput:e[12]||(e[12]=s=>o.filterComments()),id:"message_filter","onUpdate:modelValue":e[13]||(e[13]=s=>t.message_filter=s),type:"text",class:"form-input bg-gray-900 rounded-md w-full placeholder-white",placeholder:"MESSAGE"},null,544),[[d,t.message_filter]])])]),r("div",{onScroll:e[14]||(e[14]=(...s)=>o.onCommentScroll&&o.onCommentScroll(...s)),class:"h-full scrollbar-thin scrollbar-thumb-green-900 scrollbar-track-gray-500 scrollbar scrollbar-thumb-green-900 hover:scrollbar-thumb-green-800 scrollbar-track-gray-500"},[r("div",N,[r("div",R,[(u(!0),h(b,null,_(t.loadedComments,s=>(u(),h("div",q,[r("div",G,c(o.formatDate(s.created_at)),1),r("div",K,c(s.username),1),r("div",J,c(s.message),1)]))),256))])])],32)])])])}var W=w(S,[["render",Q],["__scopeId","data-v-b535c16a"]]);C.add(x);I(W).component("font-awesome-icon",V).mount("#app");
