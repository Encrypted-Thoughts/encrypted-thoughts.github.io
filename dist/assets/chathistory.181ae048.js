import{_ as k}from"./plugin-vue_export-helper.f9bdc015.js";import{I as S,h as g,i as _,r as v,c as h,d as r,n as p,w as a,j as C,e as w,v as f,k as z,m as x,q as I,s as V,a as b,o as m,t as c,u as F,l as y,x as L,y as P,z as U,f as D,F as A}from"./vendor.3674b703.js";const M={name:"ChatHistory",components:{InfiniteLoading:S},data:()=>({client_id:"icyqwwpy744ugu5x4ymyt6jqrnpxso",code:"",username:"",vod_filter:"",start_filter:"",end_filter:"",user_filter:"",message_filter:"",vods:[],infiniteId:0,selectedVod:0,filteredVods:[],commentChunkCursors:[""],currentChunkId:0,comments:[],cancelCommentFetch:!1,commentFetchInProgress:!1,selectSize:window.innerHeight<800?0:20}),methods:{handleWindowResize(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isMobile()?this.selectSize=0:this.selectSize=window.innerHeight<800?0:20},100)},isMobile(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},formatDate(e){if(e)return g(String(e)).format("YYYY-MM-DD")},formatTime(e){if(e)return g(String(e)).format("hh:mm:ss A")},filterVods(e){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{e.target.id==="vod-filter"?this.vod_filter=e.target.value:e.target.id==="start-time"?this.start_time=e.target.value:e.target.id==="end-filter"&&(this.end_time=e.target.value),this.$refs.vodSelect[0].selected=!0,this.filteredVods=this.vods.filter(this.compareVod)},200)},compareVod(e){return!(!e.title.toLowerCase().includes(this.vod_filter.toLowerCase())&&this.vod_filter!==""||g(e.created_at).isBefore(this.start_filter)&&this.start_filter!==""||g(e.created_at).isAfter(this.end_filter)&&this.end_filter!=="")},filterComments(e){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{e.target.id==="user-filter"?this.user_filter=e.target.value:e.target.id==="message-filter"&&(this.message_filter=e.target.value),this.reloadComments()},200)},async loadComments(e){if(this.selectedVod===0){e.complete();return}if(this.commentFetchInProgress){for(this.cancelCommentFetch=!0;this.commentFetchInProgress;)await new Promise(i=>setTimeout(i,1e3));this.reloadComments()}const t={"Client-ID":this.client_id},d=`https://api.twitch.tv/v5/videos/${this.selectedVod}/comments`;var l=this.commentChunkCursors[this.currentChunkId];this.commentFetchInProgress=!0,this.cancelCommentFetch=!1;do{var u=l===null||l===""?`${d}?content_offset_seconds=0`:`${d}?cursor=${l}`;const i=await _.get(u,{headers:t});var o=i.data.comments.map(n=>({created_at:n.created_at,username:n.commenter.display_name,message:n.message.body,user_color:n.message.user_color,vod_link:`https://www.twitch.tv/videos/${this.selectedVod}?t=${Math.floor(n.content_offset_seconds/3600)}h${Math.floor(n.content_offset_seconds/60)}m${Math.floor(n.content_offset_seconds%60)}s`}));if(this.comments.push(...o.filter(this.compareComment)),!i.data._next){e.loaded(),e.complete();break}if(this.comments.length>this.currentChunkId*1e3+5e3){this.commentChunkCursors.push(i.data._next),this.currentChunkId+=1,e.loaded();break}l=i.data._next}while(l&&!this.cancelCommentFetch);this.commentFetchInProgress=!1,this.cancelCommentFetch=!1},compareComment(e){return!(!e.username.toLowerCase().includes(this.user_filter.toLowerCase())&&this.user_filter!==""||!e.message.toLowerCase().includes(this.message_filter.toLowerCase())&&this.message_filter!=="")},async getUserId(){const e={"Client-ID":this.client_id,Authorization:"Bearer "+this.code};return(await _.get(`https://api.twitch.tv/helix/users?login=${this.username}`,{headers:e})).data.data[0].id},async getVods(){var e=await this.getUserId(),t="";this.vods=[],this.filteredVods=[];do{const l={"Client-ID":this.client_id,Authorization:"Bearer "+this.code},u=await _.get(`https://api.twitch.tv/helix/videos?user_id=${e}&first=100&after=${t}`,{headers:l});var d=u.data.data.map(o=>({id:o.id,created_at:o.created_at,title:o.title}));if(this.vods.push(...d),this.filteredVods.push(...d.filter(this.compareVod)),u.data.pagination.cursor)t=u.data.pagination.cursor;else break}while(t)},async reloadComments(){this.comments=[],this.commentChunkCursors=[""],this.cancelCommentFetch=!0,this.currentChunkId=0,this.infiniteId+=1}},created:function(){const e=new URLSearchParams(window.location.search),t=new URLSearchParams(window.location.hash.substr(1));e.get("code")?this.code=urlParams.get("code"):t.get("access_token")&&(this.code=t.get("access_token")),window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize()},destroyed(){window.removeEventListener("resize",this.handleWindowResize)}},T={class:"flex flex-wrap h-full w-full text-white p-2"},B={class:"h-1/3 w-full xl:w-1/3 xl:h-full border-b-4 border-gray-600 pb-2 xl:pb-0 xl:pr-2 xl:border-b-0 xl:border-r-4"},E={class:"flex flex-col h-full w-full gap-2"},O={class:"flex flex-wrap gap-2 min-w-full"},W={class:"flex gap-2 min-w-full max-h-full pb-2 border-b-5 border-gray-600"},R=["href"],H={class:"text-xs md:text-base xl:text-lg"},$={class:"text-xs md:text-base xl:text-lg"},j=b("ALLOWED "),Y=["disabled"],q={class:"text-xs md:text-base xl:text-lg"},N=b("VODS "),G={class:"flex gap-2 min-w-full"},J=["disabled","size"],K={ref:"defaultOption",value:"",disabled:"",hidden:"",selected:"",class:"rounded-sm even:bg-gray-800 w-full p-1 pl-3"},Q=["value"],X={class:"h-2/3 w-full xl:w-2/3 xl:h-full pt-2 xl:pt-0 xl:pl-2"},Z={class:"flex flex-col rounded-md h-full border-3 border-gray-600 bg-gray-900"},ee={class:"flex w-full border-b-4 border-gray-600"},te={"infinite-wrapper":"",class:"scrollbar-thin scrollbar-thumb-green-900 scrollbar-track-gray-500 scrollbar scrollbar-thumb-green-900 hover:scrollbar-thumb-green-800 scrollbar-track-gray-500"},se={class:"flex even:bg-gray-800"},re={class:"px-3 py-1 w-full self-center"},oe=["href"],ie=["href"],ne=b("chat not loaded");function ae(e,t,d,l,u,o){const i=v("font-awesome-icon"),n=v("infinite-loading");return m(),h("div",T,[r("div",B,[r("div",E,[r("div",O,[r("div",W,[r("a",{href:`https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=${e.client_id}&redirect_uri=https://encrypted-thoughts.github.io/chat-history&scope=chat:read&force_verify=true`,class:p([e.code?"":"animate-pulse","w-1/4 text-center bg-gray-900 border-2 border-gray-600 hover:bg-gray-700 font-bold py-2 px-1 shadow-lg rounded-md"])},[a(r("span",H,"ALLOW ACCESS",512),[[C,!e.code]]),a(r("span",$,[j,w(i,{icon:"check",class:"text-green-600"})],512),[[C,e.code]])],10,R),a(r("input",{onInput:t[0]||(t[0]=s=>e.username=s.target.value),"onUpdate:modelValue":t[1]||(t[1]=s=>e.username=s),type:"text",class:"form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900 px-3 py-2 rounded-md w-2/4",placeholder:"Enter a username..."},null,544),[[f,e.username]]),r("button",{onClick:t[2]||(t[2]=s=>o.getVods()),disabled:!e.username||!e.code,class:"bg-gray-900 border-2 border-gray-600 hover:bg-gray-700 font-bold py-2 px-1 shadow-lg rounded-md w-1/4 disabled:opacity-50"},[r("span",q,[N,w(i,{icon:"search"})])],8,Y)]),r("div",G,[a(r("input",{onInput:t[3]||(t[3]=s=>o.filterVods(s)),id:"vod-filter","onUpdate:modelValue":t[4]||(t[4]=s=>e.vod_filter=s),type:"text",class:"w-1/3 focus:outline-none focus:ring-0 focus:border-green-700 form-input bg-gray-900 px-3 py-2 rounded-md disabled:opacity-50",placeholder:"Filter on VOD name..."},null,544),[[f,e.vod_filter]]),a(r("input",{onInput:t[5]||(t[5]=s=>o.filterVods(s)),id:"start_time","onUpdate:modelValue":t[6]||(t[6]=s=>e.start_filter=s),type:"datetime-local",class:p([e.start_filter?"":"start-time","w-1/3 flex-1 form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900 px-3 py-2 rounded-md disabled:opacity-50"]),placeholder:"Start time filter..."},null,34),[[f,e.start_filter]]),a(r("input",{onInput:t[7]||(t[7]=s=>o.filterVods(s)),id:"end_time","onUpdate:modelValue":t[8]||(t[8]=s=>e.end_filter=s),type:"datetime-local",class:p([e.end_filter?"":"end-time","w-1/3 flex-1 form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900 px-3 py-2 rounded-md disabled:opacity-50"]),placeholder:"End time filter..."},null,34),[[f,e.end_filter]])])]),a(r("select",{ref:"vodSelect",onChange:t[9]||(t[9]=(...s)=>o.reloadComments&&o.reloadComments(...s)),"onUpdate:modelValue":t[10]||(t[10]=s=>e.selectedVod=s),disabled:e.vods.length===0,size:e.selectSize,class:p([e.selectSize>0?"bg-none p-0":"","focus:outline-none focus:ring-0 focus:border-green-800 h-full w-full border-2 border-gray-600 bg-gray-900 rounded-md scrollbar-thin scrollbar-thumb-green-900 hover:scrollbar-thumb-green-800 scrollbar-track-gray-500 break-words whitespace-normal"])},[r("option",K,"Select a vod...",512),(m(!0),h(x,null,I(e.filteredVods,(s,de)=>(m(),h("option",{value:s.id,class:"rounded-sm even:bg-gray-800 w-full p-1 pl-3"},c(o.formatDate(s.created_at))+": "+c(s.title),9,Q))),256))],42,J),[[z,e.selectedVod]])])]),r("div",X,[r("div",Z,[r("div",ee,[a(r("input",{onInput:t[11]||(t[11]=s=>o.filterComments(s)),id:"user_filter","onUpdate:modelValue":t[12]||(t[12]=s=>e.user_filter=s),type:"text",class:"w-1/2 form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900",placeholder:"Filter on username..."},null,544),[[f,e.user_filter]]),a(r("input",{onInput:t[13]||(t[13]=s=>o.filterComments(s)),id:"message_filter","onUpdate:modelValue":t[14]||(t[14]=s=>e.message_filter=s),type:"text",class:"w-1/2 form-input focus:outline-none focus:ring-0 focus:border-green-700 bg-gray-900",placeholder:"Filter on message..."},null,544),[[f,e.message_filter]])]),r("div",te,[(m(!0),h(x,null,I(e.comments,s=>(m(),h("div",se,[r("div",re,[r("a",{class:"text-gray-400 pr-1",href:s.vod_link,target:"_blank",rel:"noopener noreferrer"},c(o.formatTime(s.created_at)),9,oe),r("a",{style:F({color:s.user_color}),href:`https://www.twitch.tv/${s.username}`,target:"_blank",rel:"noopener noreferrer"},c(s.username),13,ie),r("span",null,": "+c(s.message),1)])]))),256)),w(n,{spinner:"2",forceUseInfiniteWrapper:"true",distance:200,identifier:e.infiniteId,onInfinite:o.loadComments,class:"even:bg-gray-800"},{"no-more":V(()=>[b("end of chat ("+c(this.comments.length)+" messages)",1)]),"no-results":V(()=>[ne]),_:1},8,["identifier","onInfinite"])])])])])}var le=k(M,[["render",ae],["__scopeId","data-v-5ddc9e0f"]]);y.add(L);y.add(P);y.add(U);D(le).component("font-awesome-icon",A).mount("#app");
